<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Minesweeper-Game</title>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:wght@700&display=swap" rel="stylesheet">

</head>
<style>
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
        font-family: 'Roboto Mono', monospace;
    }

    .wrapper {
        height: 100vh;
        width: 100%;
        display: flex;
        background: linear-gradient(to bottom right, #DD95F7 0%, #9AADF9 50%, #7FC9D9 100%);
    }

    .container {
        margin: auto;
        width: 500px;
        align-content: center;
    }

    .grid {
        height: 400px;
        width: 400px;
        display: flex;
        flex-wrap: wrap;
        background-color: #dcd6bc;
        /* margin: 20px 0px 10px 50px; */
    }

    .grid div {
        height: 40px;
        width: 40px;
        border: 5px solid;
        border-color: #f5f3eb #bab7a9 #bab7a9 #fff9db;
        box-sizing: border-box;
        display: flex;
        justify-content: center;
        align-items: center;
        user-select: none;

    }

    .flags {
        margin: 20px 90px;
        font-size: 25px;
    }
</style>

<body>
    <div class="wrapper">
        <div class="box container">
            <div class="grid"></div>
            <div class="flags">Flags left: <span id="flag-left">20</span></div>
            <div id="result"></div>
        </div>
    </div>
</body>

<script>

    const grid = document.querySelector(".grid");
    const flag = document.querySelector("#flag-left");


    let width = 10;
    let bombAmount = 20;
    let squares = [];
    let flags = 20;

    //create board
    function createBoard() {

        let shuffledArray = Array(width * width).fill('valid');
        let randomBombsIndex = [];
        while (randomBombsIndex.length <= 20) {
            let r = Math.floor(Math.random() * (99 - 0 + 1)) + 0;
            if (!randomBombsIndex.includes(r)) {
                randomBombsIndex.push(r);
                shuffledArray[r] = "bomb";
            }
        }
        console.log(shuffledArray);

        // console.log(randomBombsIndex);

        //creating squares
        for (let i = 0; i < width * width; i++) {
            const square = document.createElement("div");
            // square.setAttribute("id",i);
            square.id = i;
            square.classList.add(shuffledArray[i]);
            grid.appendChild(square);
            squares.push(square);

            //display bobms in grid - for testing purposes
            // if(shuffledArray[i] == 'bomb')
            // {
            //     squares[i].innerHTML='ðŸ’£';
            // }

            //square normal click functionality
            square.onclick = () => {
                console.log("click");
                clickBait(square);
            }

            square.addEventListener("contextmenu", function (event) {
                event.preventDefault();
                addFlag(square);
            });

        }
        //add numbers to grid
        calculateSquareValues();
    }
    createBoard();

    function clickBait(square) {
        // console.log('click');
        if (square.classList.contains("bomb")) {
            console.log("game over");

            for (let i = 0; i < squares.length; i++) {
                squares[i].onclick = "";
                if (squares[i].classList.contains("bomb") && !squares[i].classList.contains("flag")) {
                    squares[i].innerHTML = 'ðŸ’£';
                    squares[i].style.border = "1px solid gray";
                    squares[i].style.backgroundColor = "red";
                }

            }
        }
        else if (!square.classList.contains("flag") ) {
            // square.style.border = "1px solid gray";
            let x = square.getAttribute("id");
            // console.log(x);
            callRecursion(x);
        }

    }
    function callRecursion(i) {
        // let i = square.getAttribute("id");
        // console.log(square);

        const square = document.getElementById(i);
        console.log(i);
        if(square.classList.contains("flag") )

        if (!square.classList.contains("checked")) {

            square.style.backgroundColor = "#bab7a9";
            square.style.border = "1px solid gray";


            const leftEdge = (i % width == 0);
            const rightEdge = (i % width == width - 1)

            let total = 0;
            //four sides
            if (i + 1 % 10 != 9 && square.classList.contains('valid')) {
                if (!square.classList.contains('bomb')) {callRecursion(parseInt(i) + 1);}
            }

            if (i-1 % 10 != 0 && square.classList.contains('bomb')) total++;
            if (i > 9 && square.classList.contains('bomb')) total++;
            if (i < 90 && square.classList.contains('bomb')) total++;

            //diagonal corners
            if (!leftEdge && i > 9 && square.classList.contains("bomb")) total++;
            if (!leftEdge && i < 90 && square.classList.contains("bomb")) total++;
            if (!rightEdge && i > 9 && square.classList.contains("bomb")) total++;
            if (!rightEdge && i < 90 && square.classList.contains("bomb")) total++;
        }

        square.classList.add("checked");


    }


    function addFlag(square) {
        // console.log("add flag");
        if (flags > 0) {

            if (!square.classList.contains("flag")) {
                square.classList.add("flag");
                square.innerHTML = "";
                square.innerHTML = 'ðŸš©';
                flags--;
                flag.innerHTML = flags;
            }

            else {
                square.classList.remove("flag");
                square.innerHTML = " ";
                flags++;
                flag.innerHTML = flags;
            }
            
        }
    }

    function calculateSquareValues() {
        

        for (let i = 0; i < width * width; i++) {
            //checks number of bobms and display count more than 0;

            let total = 0;
            const leftEdge = (i % width == 0);
            const rightEdge = (i % width == width - 1)

            if (squares[i].classList.contains('valid')) {

                //four sides
                if (i % 10 != 9 && squares[i + 1].classList.contains('bomb')) total++;
                if (i % 10 != 0 && squares[i - 1].classList.contains('bomb')) total++;
                if (i > 9 && squares[i - width].classList.contains('bomb')) total++;
                if (i < 90 && squares[i + width].classList.contains('bomb')) total++;

                //diagonal corners
                if (!leftEdge && i > 9 && squares[i - width - 1].classList.contains("bomb")) total++;
                if (!leftEdge && i < 90 && squares[i + width - 1].classList.contains("bomb")) total++;
                if (!rightEdge && i > 9 && squares[i - width + 1].classList.contains("bomb")) total++;
                if (!rightEdge && i < 90 && squares[i + width + 1].classList.contains("bomb")) total++;


                
                squares[i].setAttribute('data', total);
                if (total > 0) {
                    squares[i].innerHTML = total;
                    // squares[i].style.border="1px solid gray";
                }
            }
        }
    }



</script>

</html>